From 92f7900de0b7b4685fc552b18f54b120ef79728d Mon Sep 17 00:00:00 2001
From: Zihao Yu <yuzihao@ict.ac.cn>
Date: Sat, 28 Aug 2021 23:44:50 +0800
Subject: [PATCH 13/74] SoC: use APBXbar

---
 src/SoC.scala | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/SoC.scala b/src/SoC.scala
index 358dd12f..ffe141ab 100644
--- a/src/SoC.scala
+++ b/src/SoC.scala
@@ -40,6 +40,7 @@ class ysyxSoCASIC(implicit p: Parameters) extends LazyModule {
 
   val chipMaster = LazyModule(new ChipLinkMaster)
   val xbar = AXI4Xbar()
+  val apbxbar = LazyModule(new APBFanout).node
 
   val cpuMasterNode = AXI4MasterNode(p(ExtIn).map(params =>
     AXI4MasterPortParameters(
@@ -53,7 +54,8 @@ class ysyxSoCASIC(implicit p: Parameters) extends LazyModule {
   val spiNode  = APBSlaveNodeGenerator(p(ExtBus), 0x10000000, 0x10001000)
   val uartNode = APBSlaveNodeGenerator(p(ExtBus), 0x20001000, 0x1000)
 
-  List(chiplinkNode, spiNode := AXI4ToAPB(), uartNode := AXI4ToAPB()).map(_ := xbar)
+  List(spiNode, uartNode).map(_ := apbxbar)
+  List(chiplinkNode, apbxbar := AXI4ToAPB()).map(_ := xbar)
   xbar := cpuMasterNode
 
   override lazy val module = new Impl
-- 
2.34.1

